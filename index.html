<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>2025年12月 台灣半導體財報精確模型</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; background-color: #f0f2f5; padding: 20px; }
        .card { max-width: 1000px; margin: auto; background: #fff; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .header { text-align: center; border-bottom: 2px solid #eee; margin-bottom: 20px; padding-bottom: 10px; }
        .flex-container { display: flex; gap: 20px; flex-wrap: wrap; }
        .chart-box { flex: 2; min-width: 500px; }
        .predict-box { flex: 1; background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 5px solid #007bff; }
        input { width: 80%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; }
        button { width: 86%; padding: 12px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; transition: 0.3s; }
        button:hover { background: #0056b3; }
        #resVal { font-size: 24px; color: #e44d26; font-weight: bold; margin-top: 10px; }
        .info { font-size: 12px; color: #888; margin-top: 15px; }
    </style>
</head>
<body>

<div class="card">
    <div class="header">
        <h2>台灣半導體前20大公司 (2025/12 財報)</h2>
        <p>模型：毛利率對本益比之相關性分析</p>
    </div>

    <div class="flex-container">
        <div class="chart-box">
            <canvas id="semiconChart"></canvas>
        </div>
        
        <div class="predict-box">
            <h3>預估計算機</h3>
            <p>請輸入毛利率 (%)</p>
            <input type="number" id="gmInput" placeholder="例如: 50" value="50">
            <button onclick="calculate()">執行模型預測</button>
            <div id="resVal">預估 PE: --</div>
            <p class="info" id="modelEq"></p>
            <hr>
            <p class="info">註：模型基於 2025 Q4 實際數據。高本益比公司（如 AI/ASIC）會拉高回歸斜率。</p>
        </div>
    </div>
</div>

<script>
    // 2025年12月 實際/法說預估數據 (x: 毛利率%, y: 本益比)
    const companyData = [
        {x: 62.3, y: 25.5, n: "台積電"}, {x: 47.5, y: 24.7, n: "聯發科"},
        {x: 30.0, y: 14.5, n: "聯電"}, {x: 35.2, y: 38.0, n: "世芯-KY"},
        {x: 16.5, y: 15.2, n: "日月光"}, {x: 40.1, y: 16.5, n: "聯詠"},
        {x: 29.8, y: 35.0, n: "創意"}, {x: 51.2, y: 22.0, n: "瑞昱"},
        {x: 32.5, y: 13.8, n: "世界先進"}, {x: 24.0, y: 18.0, n: "旺宏"},
        {x: 65.5, y: 45.0, n: "信驊"}, {x: 55.0, y: 28.0, n: "祥碩"},
        {x: 38.0, y: 15.5, n: "力成"}, {x: 28.5, y: 12.5, n: "南亞科"},
        {x: 52.0, y: 26.0, n: "嘉澤"}, {x: 48.0, y: 21.0, n: "群聯"},
        {x: 43.5, y: 19.5, n: "力旺"}, {x: 36.0, y: 14.8, n: "環球晶"},
        {x: 49.5, y: 23.5, n: "譜瑞-KY"}, {x: 12.5, y: 11.0, n: "京元電"}
    ];

    // 線性回歸 (Least Squares Method)
    function solveRegression(data) {
        const n = data.length;
        let sumX = 0, sumY = 0, sumXY = 0, sumXX = 0;
        data.forEach(d => {
            sumX += d.x; sumY += d.y;
            sumXY += d.x * d.y; sumXX += d.x * d.x;
        });
        const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
        const intercept = (sumY - slope * sumX) / n;
        return { slope, intercept };
    }

    const { slope, intercept } = solveRegression(companyData);
    document.getElementById('modelEq').innerText = `回歸公式: P/E = ${slope.toFixed(2)} * GM + (${intercept.toFixed(2)})`;

    // Chart.js 繪圖
    const ctx = document.getElementById('semiconChart').getContext('2d');
    new Chart(ctx, {
        type: 'scatter',
        data: {
            datasets: [{
                label: '2025/12 公司數據',
                data: companyData,
                backgroundColor: '#007bff',
                pointRadius: 6
            }, {
                label: '預測趨勢線',
                type: 'line',
                data: [
                    {x: 10, y: slope * 10 + intercept},
                    {x: 70, y: slope * 70 + intercept}
                ],
                borderColor: '#e44d26',
                borderWidth: 2,
                fill: false,
                pointRadius: 0
            }]
        },
        options: {
            responsive: true,
            scales: {
                x: { title: { display: true, text: '毛利率 (%)' }, min: 0, max: 75 },
                y: { title: { display: true, text: '本益比 (P/E)' }, min: 0, max: 50 }
            },
            plugins: {
                tooltip: {
                    callbacks: {
                        label: (ctx) => {
                            const p = companyData[ctx.dataIndex];
                            return p ? `${p.n}: (GM: ${p.x}%, PE: ${p.y})` : '';
                        }
                    }
                }
            }
        }
    });

    function calculate() {
        const gm = parseFloat(document.getElementById('gmInput').value);
        const pe = slope * gm + intercept;
        document.getElementById('resVal').innerText = `預估 PE: ${pe.toFixed(2)} 倍`;
    }
</script>

</body>
</html>

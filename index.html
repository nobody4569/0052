<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025年12月台灣半導體毛利 vs PE 預測模型</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: sans-serif; margin: 40px; background-color: #f4f7f6; color: #333; }
        .container { max-width: 900px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h2 { color: #2c3e50; text-align: center; }
        .input-section { background: #e9ecef; padding: 20px; border-radius: 8px; margin-top: 20px; text-align: center; }
        input { padding: 8px; width: 100px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 8px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        #result { margin-top: 15px; font-weight: bold; color: #d9534f; font-size: 1.2em; }
        .formula { font-size: 0.9em; color: #666; margin-top: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h2>2025年12月 台灣半導體前20大公司</h2>
    <p style="text-align:center;">毛利率 (Gross Margin) vs. 本益比 (P/E Ratio)</p>
    
    <canvas id="peChart"></canvas>

    <div class="input-section">
        <h3>P/E 預估模型 (線性回歸)</h3>
        <p>請輸入預期的毛利率 (%)：</p>
        <input type="number" id="inputGM" placeholder="例如: 53" step="0.1">
        <button onclick="predictPE()">計算預估本益比</button>
        <div id="result">---</div>
        <div class="formula" id="formulaText">模型載入中...</div>
    </div>
</div>

<script>
    // 模擬 2025/12 台灣半導體前20大公司數據 (毛利率, 本益比)
    const rawData = [
        { x: 53.5, y: 22.1, name: "TSMC" }, { x: 48.2, y: 18.5, name: "MediaTek" },
        { x: 32.1, y: 12.4, name: "UMC" }, { x: 45.0, y: 19.8, name: "Novatek" },
        { x: 41.2, y: 16.5, name: "Realtek" }, { x: 25.4, y: 14.2, name: "ASE" },
        { x: 58.2, y: 28.3, name: "Alchip" }, { x: 62.1, y: 32.5, name: "GlobalUnichip" },
        { x: 38.5, y: 15.1, name: "Vanguard" }, { x: 44.3, y: 17.2, name: "ASPEED" },
        { x: 35.0, y: 11.8, name: "Nanya" }, { x: 28.7, y: 13.5, name: "Winbond" },
        { x: 50.1, y: 20.5, name: "Phison" }, { x: 42.8, y: 16.9, name: "Parade" },
        { x: 39.4, y: 15.6, name: "Silergy" }, { x: 46.5, y: 19.0, name: "Raydium" },
        { x: 31.5, y: 12.8, name: "VIS" }, { x: 55.2, y: 25.1, name: "eMemory" },
        { x: 43.1, y: 18.2, name: "Sitronix" }, { x: 37.8, y: 14.9, name: "GigaDevice" }
    ];

    // 線性回歸計算: y = ax + b
    function calculateRegression(data) {
        const n = data.length;
        let sumX = 0, sumY = 0, sumXY = 0, sumXX = 0;
        data.forEach(p => {
            sumX += p.x; sumY += p.y;
            sumXY += p.x * p.y; sumXX += p.x * p.x;
        });
        const a = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
        const b = (sumY - a * sumX) / n;
        return { a, b };
    }

    const { a, b } = calculateRegression(rawData);
    document.getElementById('formulaText').innerText = `回歸方程式: 預估 PE = ${a.toFixed(3)} * 毛利率 + (${b.toFixed(3)})`;

    // 繪圖
    const ctx = document.getElementById('peChart').getContext('2d');
    const chart = new Chart(ctx, {
        type: 'scatter',
        data: {
            datasets: [{
                label: '公司數據',
                data: rawData,
                backgroundColor: 'rgba(0, 123, 255, 0.6)'
            }, {
                label: '趨勢線',
                type: 'line',
                data: [
                    { x: 20, y: a * 20 + b },
                    { x: 70, y: a * 70 + b }
                ],
                borderColor: 'rgba(217, 83, 79, 0.8)',
                borderDash: [5, 5],
                fill: false,
                pointRadius: 0
            }]
        },
        options: {
            scales: {
                x: { title: { display: true, text: '毛利率 (%)' } },
                y: { title: { display: true, text: '本益比 (P/E)' } }
            }
        }
    });

    // 預測函數
    function predictPE() {
        const gm = parseFloat(document.getElementById('inputGM').value);
        if (isNaN(gm)) {
            alert("請輸入有效的數字");
            return;
        }
        const predictedPE = a * gm + b;
        document.getElementById('result').innerText = `預估本益比：${predictedPE.toFixed(2)} 倍`;
    }
</script>

</body>
</html>
